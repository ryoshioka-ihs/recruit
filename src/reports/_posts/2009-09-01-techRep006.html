---
title:         "仮想化環境における構築・運用のポイント 第6回"
description:   "サーバの仮想化は、昨今のIT業界において注目されているテーマの1つです。当社ではVMware Infrastructure導入作業、運用手順書作成などの実績から、仮想化環境構築のノウハウをご紹介します。"
keywords:      "仮想化,VMware,vShere,vCenter,ESXi"
date:          2009-10-06 00:00:00 +0900
link:		   ""
categories:
- "技術レポート"
tags:
---

<p>前回の記事では、サーバ個々のパフォーマンスチューニングについて考察しました。今回は、第1回で挙げた5つの課題の中から、「障害対策（バックアップ／リストア）」について考えていきたいと思います。</p>

<h2>障害対策（バックアップ／リストア）</h2>
<p>第4回の「本番・保守・開発・テスト環境の効率化」でも触れましたが、仮想化環境では、仮想サーバのイメージをそのままバックアップすることができます。</p>
<br>
<p>イメージバックアップ<small class="notes">（注1）</small>は、バックアップ時のシステム状態やデータをそのまま復元できるため、ハードウェアの故障や重度のOS障害などで起動できなくなったサーバのサービスを迅速に復旧したい場合には、非常に便利なバックアップです。</p>
<p>しかしながら、イメージバックアップだけで仮想化環境のすべてのバックアップを賄うことは現実的ではありません。</p>
<br>
<p>イメージバックアップは、基本的にオフラインバックアップ（サービス停止を伴うバックアップ）でかつ、フルバックアップであるため、データベースのデータなど日次で取得するようなバックアップには不向きだからです。</p>
<small class="notes">※有償ソフトウェアには、オンラインバックアップ、差分バックアップに対応しているものも存在します。</small><br>
<br>
<p>よって、仮想サーバのバックアップは、イメージバックアップとデータバックアップを組み合わせて取得し、障害発生時には、状況に応じてそれぞれのバックアップからリストアを行うことになります。</p>
<p class="textIndent--style1"><small class="notes">（注1）イメージバックアップ<br />
	イメージバックアップとは、ファイル単位ではなく、ハードディスクのセクタ単位でバックアップを行い、１つのファイル（イメージファイル）として保存すること。</small></p>

<h3>例1）誤って削除したデータを元に戻したい場合</h3>
<p>稼動中の仮想サーバにデータバックアップを復元する</p>
	<div class="lightBox">
		<figure>
			<img src="/image/reports/techRep006_01.jpg" alt="稼動中の仮想サーバにデータバックアップを復元する">
		</figure>
	</div>
<h3>例2）OSが起動しなくなったサーバを復旧したい場合</h3>
<p>まず物理サーバにイメージバックアップを復元し、復旧した仮想サーバにデータバックアップを復元する</p>
	<div class="lightBox">
		<figure>
			<img src="/image/reports/techRep006_02.jpg" alt="まず物理サーバにイメージバックアップを復元し、復旧した仮想サーバにデータバックアップを復元する">
		</figure>
		<figcaption>（注2）ハイパーバイザー：<br />
ハイパーバイザーは、ハードウェアの仮想化を実現する低レベルのソフトウェア。動作に特定のOSを必要とせず、ハイパーバイザーの組み込みだけで、複数OSを動かす仮想環境を実現できる。</figcaption>
	</div>
<br>
<br>
<p>以上を踏まえ、仮想化環境におけるバックアップのポイントについてご紹介していきます。</p>

<h2>初回導入時・構成変更時にはシステムバックアップを取得する</h2>
<p>前述のとおり、イメージバックアップはOSの再インストールを伴うような重度の障害からサービスを復旧したい場合に有効なバックアップです。</p>
<p>よって、サーバの新規導入時や、サービスパック適用などの構成変更時に、作業完了後のバックアップを取得しておくことで、有事の際のサーバ再セットアップにかかる時間を短縮することができます。</p>
<p>イメージバックアップを取得する場合の注意点は、以下2点です。</p>

<h3>1）どのバックアップにどこまでの変更が含まれているかを管理する</h3>
<p>複数世代分のイメージバックアップを保存していると、どのバックアップにどこまでの変更が加えられているのかが曖昧になる可能性があります。
よって、復元後の設定漏れを防ぐためにも、イメージバックアップ単位でのサーバの構成管理を徹底する必要があります。
また、定期的に管理者パスワードを変更している場合などは、バックアップ当時のパスワードがわかるようにしておくほうが良いでしょう。</p>

<h3>2）イメージ復元後にサーバ間で不整合が起こらないように注意する</h3>
<p>サーバの種類によっては、最新のサーバと過去のサーバとの間で不整合を起こすケースも考えられます。<br />
よって、互いに構成情報の複製を持つサーバや、依存関係にあるサーバのバックアップを取得する場合には、復元時に正常稼動できるかどうか、事前に確認しておく必要があります。</p>

<h2>データバックアップの保存先・保存方法を検討する</h2>
<p>データバックアップは、専用のサーバ（バックアップサーバ）を導入し、各サーバのバックアップを一元管理するケースが多いと思います。</p>
<p>仮想化環境でも、仮想サーバにバックアップソフトウェア（エージェント）を導入することで、物理サーバ環境で使用していたバックアップ方式を、ほぼそのまま適用することができます。</p>
<br>
<p>ただし、専用のバックアップサーバを仮想サーバとして構築する場合には、注意が必要です。仮想バックアップサーバを利用する場合の注意点は、以下2点です。</p>

<h3>1）バックアップ先は大容量ストレージを準備する</h3>
<p>物理サーバ環境では、バックアップ先にサーバ付属のテープ装置を使用しているケースが多いかと思います。
しかし、仮想サーバはこのテープ装置のデバイスを認識できないため、バックアップ先は 必然的にハードディスク上ということになります。
<br />よって、バックアップデータの安全性を考慮し、大容量ストレージの導入を検討する必要が あります。</p>

<h3>2）ディザスタリカバリには仕組みの検討が必要</h3>
<p>前述の通り、仮想バックアップサーバが直接データを保存できるのは、ハードディスク上です。 <br />
よって、ディザスタリカバリ対策として遠隔地にバックアップを保管する必要がある場合には、ハードディスク上に保存されたバックアップを、別の記録装置にコピーする仕組みを検討する必要があります。</p>
<br>
<p>上記内容に関して、ご不明な点またはご質問などがございましたら、お気軽にお問い合わせ下さい。また、インフラ構築作業に関しましてご興味がございましたら、IIMヒューマン・ソリューション営業担当までお問い合わせ下さい。 </p>