---
title:         "マイクロソフト仮想化(Hyper-V)について"
description:   "昨今、IT業界において仮想化の技術は幅広く浸透してきました。仮想化技術が進歩する中、今回の記事では、マイクロソフト社の仮想化技術のご紹介と、その一部であるハイパーバイザ型の仮想化ソリューションHyper-Ｖについてご紹介していきたいと思います。"
keywords:      ""
date:          2011-03-08 00:00:00 +0900
link:		       ""
categories:
- "インフラ構築"
- "運用サービス"
- "技術レポート"
tags:
- "仮想化"
- "Hyper-V"
---

<p>昨今、IT業界において仮想化の技術は幅広く浸透してきました。仮想化技術が進歩する中、今回の記事では、マイクロソフト社の仮想化技術のご紹介と、その一部であるハイパーバイザ型の仮想化ソリューションHyper-Ｖについてご紹介していきたいと思います。</p>
<ol class="numList">
	<li>マイクロソフトの仮想化技術</li>
	<li>サーバの仮想化</li>
	<li>クライアントの仮想化</li>
	<li>Windows Server 2008 Hyper-Ｖについて</li>
	<li>仮想化環境の運用管理</li>
</ol>

<h2>1.マイクロソフトの仮想化技術</h2>
<p>マイクロソフトの仮想化技術は、下図のように大きく５つに分類されています。</p>
<div class="lightBox">
	<figure>
		<img src="/image/reports/techRep017_01.jpg" alt="マイクロソフトの仮想化技術">
	</figure>
</div>
<br>
<p>まずは、それぞれの仮想化技術について大まかにご紹介していきましょう。</p>

<h2>2.サーバの仮想化</h2>
<h3>Virtual Server</h3>
<p>ホストOS型<small class="notes">（※）</small>のサーバ仮想化技術です。サーバの使用率を向上し、アプリケーションと同じように手軽に実行することができ、新しいサーバを迅速に構築する事が可能になります。</p>
<h3>Windows Server 2008 Hyper-V</h3>
<p>ハイパーバイザ型<small class="notes">（※）</small>のサーバ仮想化技術です。１台の物理ハードウェア（PCサーバ）のリソースを複数のサーバで共有することが可能になるため、サーバ運営に関わるコストの削減や、サーバの使用率の向上などを図ることが可能となります。</p>
<br>
<p class="textIndent--style1"><small class="notes">※ホストOS型とハイパーバイザ型<br>
ホストOS型は、Windows、Linux、Mac OSなどのOSに仮想化ソフトウェアをインストールし、そこに仮想マシンを構築するタイプの仮想化技術です。仮想マシンとハードウェアの間にフル機能のOSが存在するため、実行時のオーバヘッドが大きく実行速度が遅くなります。<br>
<br>
一方、ハイパーバイザ型は、ハードウェアのBIOSから直接、仮想化ソフトウェアを起動し、そこで仮想マシンを構築するタイプの仮想化技術です。ホストOS型と比較すると、ホストOSを介さないためオーバーヘットが小さく安定性があり、パフォーマンスを重視するサーバ仮想化の主流となっています。</small></p>
<div class="lightBox">
	<figure>
		<img src="/image/reports/techRep017_02.jpg" alt="ホストOS型とハイパーバイザ型の違い">
	</figure>
</div>

<h2>3.クライアントの仮想化</h2>
<h3>アプリケーションの仮想化</h3>
<div class="grayBorBox">
	<section>
		<h4>Microsoft Application Virtualization (App-V)</h4>
		<p>クライアントPCにアプリケーションをインストールすることなく、仮想環境で実行します。これにより、アプリケーションの実行ファイルをOS上で実行するだけで、どのようなアプリケーションでも実行可能となり、通常では同一マシンで実行できない複数バージョンのMicrosoft Officeなどを同時に実行することが可能になります。</p>
	</section>
</div>

<h3>プレゼンテーションの仮想化</h3>
<div class="grayBorBox">
	<section>
		<h4>ターミナル サービス</h4>
		<p>サーバ側のマルチユーザー機能を利用するもので、共有のサーバ（ターミナルサーバ）で仮想的に構成されたWindowsデスクトップを、クライアントPCやシンクライアントのようなリモートシステム上で表示させ、サーバ上のアプリケーションを操作することが出来ます。この場合、ユーザは同一のサーバOSとその上で動作するアプリケーションを利用することになります。</p>
	</section>
</div>

<h3>デスクトップの仮想化</h3>
<div class="grayBorBox">
	<section>
		<h4>Virtual Desktop Infrastructure（VDI）およびVDA</h4>
		<p>プレゼンテーションの仮想化（ターミナル サービス）とよく似ていますが、VDIはサーバ上でクライアント毎に仮想化されたデスクトップにリモート接続		し、ローカルにインストールされた通常のクライアントPCのデスクトップと同じような感覚で、自分のデスクトップにアクセス出来ます。</p>
	</section>
</div>
<div class="grayBorBox">
	<section>
		<h4>Microsoft Virtual PC</h4>
		<p>PC上に仮想マシン環境を構築するためのソフトウェアで、Virtual PCをインストールすると、一台のコンピュータ上で仮想的に複数台のコンピュータが動作しているように見せかけることができます。仮想マシン上ではそれぞれ別のOSを同時に動作させることが出来ます。</p>
	</section>
</div>
<div class="grayBorBox">
	<section>
		<h4>Microsoft Enterprise Desktop Virtualization (MED-V)</h4>
		<p>サーバをベースとした集中管理型のシステムで、OSやアプリケーションのインストールと設定を済ませた仮想マシンをパッケージ化し、複数のクライアントPCにパッケージを選択して自動配布することで、仮想マシンの集中管理を実現します。</p>
	</section>
</div>

<h3>ストレージの仮想化</h3>
<div class="grayBorBox">
	<section>
		<h4>System Center Data Protection Manager</h4>
		<p>ディスクベースのバックアップと回復を最適化するサーバソフトウェアアプリケーションです。テープ装置もサポートしており、柔軟なバックアップに対応しています。高速かつ確実なデータ回復、効率的かつ連続的なデータ保護、および操作の簡易性を実現します。</p>
	</section>
</div>
<div class="grayBorBox">
	<section>
		<h4>Windows Storage Server</h4>
		<p>サーバ向けOSであるWindows Server 2008をベースに、iSCSIなどストレージ機器に必要な機能を搭載した、アプライアンスサーバです。		CAL（クライアントアクセスライセンス）不要で利用でき、コスト削減に有効な製品です。</p>
	</section>
</div>


<h2>4．Windows Server 2008 Hyper-Ｖについて</h2>
<p>では、前述で記載した仮想化技術の中から、サーバの仮想化技術であるWindows Server 2008 Hyper-Vについて詳しくご紹介していきましょう。</p>
<h3>Hyper-Ｖとは</h3>
<p>Hyper-Ｖは、最新OSであるWindows Server 2008 に標準搭載されているハイパーバイザ型の仮想化ソリューションです。Microsoft System Centerを始めとしたマイクロソフト製品との親和性の高さが特徴で、１台の物理ハードウェア（PCサーバ）上で複数の仮想サーバを同時に実行することで、リソースを複数のサーバで共有することが可能になるため、少ないハードウェアで効率よくサーバを稼働させることが出来ます。</p>
<br>
<p>また、それぞれ干渉しない低リスクな開発環境を構築したり、動作環境のバージョンが異なる新旧のシステムを統合運用したりといったことも可能となります。Hyper-V は、Windows Server 2008 に標準搭載されているため、サードパーティ製のソフトウェアを購入する必要なく、Windows Server 2008 を使用した仮想化によるコスト削減を、これまでになく簡単に実現できるようになりました。</p>

<h3>Hyper-V の特徴</h3>
<h4>サポート・プロセッサ数の強化</h4>
<p>１つの論理プロセッサに対して最大8個までの仮想プロセッサを割り当てることが可能です。Hyper-Vがサポートする最大論理プロセッサ数は64コアであるため、仮想マシンでは最大64&times;8=512個の仮想プロセッサが利用可能となり、1台の物理マシンでより多くの仮想マシンを同時実行させることができるようになりました。</p>

<h4>ライブ・マイグレーション（Live Migration）</h4>
<p>稼働中の仮想マシンを、ダウンタイムなしで別の物理サーバに移行できる技術です。</p>
<br>
<p>ライブ・マイグレーションの動作イメージは、移行先の仮想マシンが準備されている状態で、実行中の仮想マシンのメモリ状態を移行先の仮想マシンに転送していきます。そして、移行元と移行先が完全に同期した時点で実行ノードを瞬間的に切り替えるといった仕組みです。</p>

<h4>クラスタ共有ボリューム（CSV：Cluster Shared Volume)</h4>
<p>ライブ・マイグレーションを実現するためにWindows Server 2008 R2に追加された新機能です。1つのボリュームを複数のクラスタ・ノードから同じパスを使用して同時にアクセスすることが出来ます。これによりライブ・マイグレーションでのI/Oの瞬間的な切り替えを実現しています。</p>

<h4>プロセッサ互換性モード</h4>
<p>ライブ・マイグレーションのためのCPUの機能制限で、移行元と移行先のホストが異なるプロセッサを使用していても、拡張命令をマスクしてライブ・マイグレーションを可能にします。</p>

<h4>仮想ストレージのホットプラグ</h4>
<p>稼働中の仮想マシンを再起動することなく、仮想ストレージの追加や削除を行う機能（SCSIポート配下のみ）です。VHDファイルの設定容量を拡張したい場合など、ゲストOSを停止させずにディスク周りのメンテナンスしたい場合にも有効です。</p>

<h4>Second Level Address Translation（SLAT）</h4>
<p>仮想マシンから物理メモリにアクセスする際のアドレス変換処理を、ハードウェア側に一部オフロードします。これにより、仮想マシンの負荷が軽減され、ゲストOS利用時のパフォーマンスが向上します。</p>
<br>
<p>但し、SLATを利用するには、プロセッサがIntel EPT (Extended Page Tables) または AMD NPT (Nested Page Tables) に対応している必要があります。</p>

<h4>ジャンボ・フレームのサポート</h4>
<p>仮想マシンのネットワーク・インターフェイスにおいて、より大きなデータ転送を効率化する機能です。Ethernet標準のフレーム（1500bytes）よりも大きなデータサイズ（～9014bytesまで）で効率よく通信を行う事が可能で、これにより仮想マシンのCPU利用率が軽減され、ネットワークの通信速度も向上します。</p>

<h4>VMQ（Virtual Machine Queue）、TCPオフロード（TCP Chimney）</h4>
<p>ネットワーク処理のパフォーマンスを向上させるための機能です。サーバに搭載されるNIC（Network Interface Card）側の対応も必要となります。</p>
<br>
<p>TCPオフロードは、TCP/IPスタックが行う処理の一部をNIC側に任せられるため、仮想マシンによる CPU 利用率を低減し、ネットワークパフォーマンスを大幅に改善します。VMQは、仮想環境では、実際には1つしかないネットワーク・インターフェイスで複数のホストあてのパケットが多数送受信されていますが、これを各VMへ効率的に振り分け、ホストの負荷を抑える機能です。</p>

<h2>5．仮想化環境の運用管理</h2>
<p>仮想化を簡単に実装出来るようになっても、管理すべきタスクが増えて運用管理が複雑化してしまっては、時間とコストの削減には繋がりません。</p>
<br>
<p>マイクロソフト社では、物理サーバ／仮想サーバが乱立するシステムであっても、効率的に総合管理できるようにする製品群のSystem Center製品ファミリを提供しています。</p>
<br>
<p>この中でも、Hyper-Vを含む仮想化環境の一元管理と制御を担う製品System Center Virtual Machine Manager(SCVMM) についてご紹介します。</p>

<h3>System Center Virtual Machine Manager(SCVMM)</h3>
<p>多数のサーバ上に展開された仮想マシンを一元管理する機能を備える、仮想マシンの統合管理製品です。主な機能は、以下の通りです。</p>
<ul class="grayDisc">
	<li>仮想マシンの展開と管理</li>
	<li>物理サーバの負荷に応じた仮想マシンの配置</li>
	<li>仮想化環境で使用する物理リソースの最適な配分と制御</li>
	<li>仮想化環境の運用レポート</li>
	<li>物理環境から仮想マシンへの変換機能</li>
</ul>
<br>
<p>また、SCVMMは、Hyper-V、Virtual Serverおよび、VMWare製品すべての仮想マシンを管理することができます。</p>