---
title:         "マイクロソフト製品で実現するクライアント仮想化（第二回）"
description:   "前回の記事では、クライアント仮想化の種類とそれに対応するマイクロソフト社のソリューションを紹介しました。今回は、その中から「ターミナルサービス」を使用したリモート・デスクトップ型のクライアント仮想化を取り上げて、詳しく説明して行きたいと思います。"
keywords:      ""
date:          2010-12-14 00:00:00 +0900
link:		       ""
categories:
- "インフラ構築"
- "運用サービス"
- "技術レポート"
tags:
- "仮想化"
- "マイクロソフト"
---

<p>前回の記事では、クライアント仮想化の種類とそれに対応するマイクロソフト社のソリューションを紹介しました。<br/>
今回は、その中から「ターミナルサービス」を使用したリモート・デスクトップ型のクライアント仮想化を取り上げて、詳しく説明して行きたいと思います。</p>

<h2>ターミナルサービスを構成する5つの役割サービス</h2>
<p>ターミナルサービスは、Windows Server 2008の標準機能として提供されています。<br/>
ターミナルサービスを利用するには、[サーバーマネージャ]から[役割の追加]ウィザードを起動して[ターミナルサービス]の役割をインストールします。<br/>
<br>
[ターミナルサービス]の役割には、[ターミナルサーバー]、[TSライセンス]、[TSセッションブローカ]、[TSゲートウェイ]、[TS Webアクセス]の5つの役割サービスが提供されており、この中から必要なサービスを選択して導入することができます。</p>
<div class="lightBox">
	<figure>
		<img src="/image/reports/techRep014_01.jpg" alt="役割の追加ウィザード画面">
	</figure>
</div>

<h2>基本コンポーネント「ターミナルサーバー」</h2>
<p>Windows Server 2008ターミナルサービスの中核となるのが、「ターミナルサーバー」役割サービスです。
サーバーに[ターミナルサーバー]をインストールし、クライアントからリモートデスクトップでサーバーに接続することで、デスクトップ全体を仮想化することができます。
実際の処理はターミナルサーバー上で実行されるため、ユーザーが使用するクライアント端末にはシンクライアントやスペックの低いマシンを使用できます。<br/>
<br>
また、どの端末からでも同じデスクトップ環境に接続可能なため、クライアントマシンの入れ替えや出張などが発生した場合の業務への影響も抑えられます。</p>
<div class="lightBox">
	<figure>
		<img src="/image/reports/techRep014_02.jpg" alt="基本コンポーネント「ターミナルサーバー」">
	</figure>
</div>
<br>
<p>ターミナルサーバーを利用する場合には、まず[ターミナルサーバー]役割サービスをインストールしたサーバー上に、ユーザーが使用するアプリケーション（Microsoft Officeなど）をインストールしておきます。<br/>
<br>
また、[ターミナルサービス構成]でセキュリティやリダイレクトの設定を行ったり、[Windowsシステムリソースマネージャ]でユーザーへのリソースの割り当てを定義するなどして利用環境を整えます。
サーバー側の受け入れ準備が完了したら、ターミナルサーバー接続用のRDPファイルを作成してクライアントに配布します。
ユーザーがRDPファイルをダブルクリックするとリモートデスクトップ画面が開いてターミナルサーバーに接続し、サーバー上で作業を行うことができるようになります。<br/>
<br>
また、アプリケーションをRemoteAppとしてインストール・登録することで、リモート・アプリケーション型のクライアント仮想化を実現することも可能です。</p>

<h2>ブラウザからリモートデスクトップを起動する「TS Webアクセス」</h2>
<p>通常、リモートデスクトップでターミナルサーバーに接続するには、スタートメニューからリモートデスクトップ接続を起動するか、RDPファイルを実行する必要があります。
[TS Webアクセス]役割サービスをインストールすると、リモートデスクトップを起動するためのWebページが提供されます。<br/>
<br>
ユーザーは、ブラウザからWebページ（既定ではhttp://&lt;サーバー名&gt;/ts）にアクセスし、そこからリモートデスクトップやRemoteAppを起動することができます。
なお、[TS Webアクセス]を利用するためには、[ターミナルサービス]の役割のほかに、[Webサーバー（IIS）]の役割をインストールする必要があります。<br/>
<br>
また、[TS Webアクセス]は「リモートデスクトップを起動する」リンクページを提供するものであり、「ターミナルサーバーにWeb接続する（= HTTP/80やHTTPS/443でターミナルサーバーにアクセスする）」機能ではないため、注意が必要です。</p>

<h2>ターミナルライセンスを一元管理する「TSライセンス」</h2>
<p>ターミナルサービスを利用するには、必要なライセンス（TS CAL）を購入してクライアントやユーザーに割り当てる必要があります。
[TSライセンス]役割サービスをインストールすると、複数のターミナルサーバーのTS CALを一元管理したり、TS CALの発行状況をレポートで確認することができるようになります。</p>

<h2>ターミナルサーバーの負荷分散を実現する「TSセッションブローカ」</h2>
<p>ターミナルサービスの利用者が増加してくると、1台のターミナルサーバーで要求を処理することが難しくなってきます。
Windows Server 2008のターミナルサービスは、ロードバランスによる負荷分散を構成できますが、接続を一時中断したクライアントから再度接続要求を受けた際、以前に接続していたターミナルサーバーに接続するための仕組みが必要になります。<br/>
<br>
このセッション管理の機能を提供するのが、[TSセッションブローカ]役割サービスです。
[TSセッションブローカ]をインストールすると、クライアントから接続要求を受けた際、既存セッションを持つターミナルサーバーが存在するかをチェックし、存在している場合にはそのセッションを持つターミナルサーバーに接続を振り分けることができるようになります。</p>
<div class="lightBox">
	<figure>
		<img src="/image/reports/techRep014_03.jpg" alt="ターミナルサーバーの負荷分散を実現する「TSセッションブローカ」">
	</figure>
</div>

<h2>外部からターミナルサーバーに接続する「TSゲートウェイ」</h2>
<p>通常、クライアントからターミナルサービスに接続するには、RDPプロトコル（TCP3389）を使用しますが、セキュリティ上の観点から言って、このポートを外部に公開することは危険なことです。<br/>
<br>
そこで、外部からターミナルサーバーを利用したい場合には、DMZなどに[TSゲートウェイ]役割サービスをインストールしたサーバーを配置します。
クライアント～TSゲートウェイ間の通信は、RDP over HTTPで行われるため、セキュリティレベルを落とすことなく外部からターミナルサービスを利用することができるようになります。</p>
<div class="lightBox">
	<figure>
		<img src="/image/reports/techRep014_04.jpg" alt="外部からターミナルサーバーに接続する「TSゲートウェイ」">
	</figure>
</div>
<br>
<p>このように、Windows Server 2008のターミナルサービスは、OS標準機能でありながら、様々なニーズを満たすことができるようになっています。<br/>
また、役割サービスは後から追加でインストールしたり、複数のサーバーに分散して配置したりすることもできるため、少数のサーバーで試験的に導入し、徐々に機能や規模を追加して行く、といった段階的な導入にも対応することが可能です。</p>
<br>
<p>IHSでは、ターミナルサービスを使用するクライアントの仮想化からサーバーの仮想化まで幅広く対応しています。<br/>
導入時の事前調査、統合サーバー設計、統合サーバーへの移行、大規模展開、移行後の運用・保守まで一連のサービスをご提供致します。</p>
<br>
<p>上記内容に関して、ご不明な点またはご質問などがございましたら、お気軽にお問い合わせ下さい。また、仮想化サービスに関しましてご興味がございましたら、IIMヒューマン・ソリューション営業担当までお問い合わせ下さい。</p>